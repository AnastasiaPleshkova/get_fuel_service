<?xml version="1.1" encoding="utf-8" standalone="no"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
            http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">

    <changeSet id="1_create_table_vehicle" author="pleshkova">
        <createTable tableName="vehicle">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="vin" type="VARCHAR" remarks="Вин номер авто"/>
            <column name="internal_id" type="UUID" defaultValueComputed="gen_random_uuid()"
                    remarks="Уникальный внутренний ID">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created_date" remarks="Дата создания" type="timestamp(6)"
                    defaultValueComputed="TIMEZONE('UTC+3', NOW())">
                <constraints nullable="false"/>
            </column>
            <column name="updated_date" remarks="Дата обновления" type="timestamp(6)"
                    defaultValueComputed="TIMEZONE('UTC+3', NOW())">
                <constraints nullable="false"/>
            </column>
            <column name="vstamp" remarks="Версия" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="2_create_table_fuel_records" author="pleshkova">
        <createTable tableName="fuel_record">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="vehicle_id" type="BIGINT">
                <constraints referencedTableName="vehicle"
                             referencedColumnNames="id"
                             nullable="false"
                             foreignKeyName="fk_vehicle_id_fuel_record"/>
            </column>
            <column name="fuel_litres" type="VARCHAR" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="record_date" type="timestamp(6)"
                    defaultValueComputed="TIMEZONE('UTC+3', NOW())">
                <constraints nullable="false"/>
            </column>
            <column name="mileage" type="VARCHAR" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="fuel_consumption_by_vehicle" type="VARCHAR"/>
            <column name="internal_id" type="UUID" remarks="Уникальный внутренний ID"
                    defaultValueComputed="gen_random_uuid()">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="created_date" remarks="Дата создания" type="timestamp(6)"
                    defaultValueComputed="TIMEZONE('UTC+3', NOW())">
                <constraints nullable="false"/>
            </column>
            <column name="updated_date" remarks="Дата обновления" type="timestamp(6)"
                    defaultValueComputed="TIMEZONE('UTC+3', NOW())">
                <constraints nullable="false"/>
            </column>
            <column name="vstamp" remarks="Версия" type="int" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="3_create_index_internal_id_vehicle" author="pleshkova">
        <createIndex indexName="idx_vehicle_vin" tableName="vehicle" unique="false">
            <column name="vin"/>
        </createIndex>
    </changeSet>

    <changeSet id="4_create_shedlock_table" author="pleshkova">
        <createTable tableName="shedlock">
            <column name="name" type="VARCHAR(64)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="lock_until" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="locked_at" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="locked_by" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

</databaseChangeLog>